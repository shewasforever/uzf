{include file="public/_meta" /}
<link href="/static/admin/lib/webuploader/0.1.5/webuploader.css" rel="stylesheet" type="text/css" />
</head>

<body>
    <div class="page-container">
        <form action="" method="post" class="form form-horizontal" id="form-article-add">
             <div class="row cl">
                <label class="form-label col-xs-4 col-sm-2">受益人：</label>
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" name="referrer_name" id="" placeholder="受益人" value="" class="input-text" style="width:50%">
                </div>
            </div>
            <div class="row cl">
                <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品名称：</label>
                <div class="formControls col-xs-8 col-sm-9" >
                    <input type="text" class="input-text" value="{$info.pd_name|default=''}" placeholder="商品名称" name="pd_name" style="width:50%">
                </div>
            </div>
            <input type="text" class="hidden" value="{$info.id|default=''}" name="id">
            <div class="row cl">
                <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品分类：</label>
                <div class="formControls col-xs-8 col-sm-9"> <span class="select-box" style="width:50%">
                <select name="cate_id" class="select">
                    <option value="0">选择产品分类</option>
                    {volist name="cate" id="vo"}
                        <option value="{$vo.id}" disabled>{$vo.cate_name}</option>
                        {volist name="$vo['son']" id="v"}
                            <option value="{$v.id}" >|—{$v.cate_name}</option>
                        {/volist}
                    {/volist}
                </select>
				</span> </div>
            </div>
            <div class="row cl">
                <label class="form-label col-xs-4 col-sm-2">所属分区：</label>
                <div class="formControls col-xs-8 col-sm-9"> <span class="select-box" style="width:50%">
                <select name="pd_zone" class="select">
                    <option value="1">大综商品</option>
                    <option value="2">信用宝加现金</option>
                    <option value="3">信用宝</option>
                    <option value="4">会员专区</option>
                    <option value="5">达人套餐  </option>
                    <option value="6">云客套餐</option>
                    <option value="7">公使套餐</option>
                    <option value="8">大使套餐</option>
                    <option value="10">三农产品</option>
                </select>
                </span>
                </div>
            </div>
            <div class="row cl">
                <label class="form-label col-xs-4 col-sm-2">大综商品分润额</label>
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" name="frontal" id="" placeholder="分润额" value="" class="input-text" style="width:50%">
                </div>
            </div>
            <!-- <div class="row cl">
                <label class="form-label col-xs-4 col-sm-2">产品让利额：</label>
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" name="pd_yilian" id="" placeholder="产品让利额" value="{$info.pd_yilian|default=''}" class="input-text" style="width:50%"> 元
                </div>
            </div> -->
            <div class="row cl">
                <label class="form-label col-xs-4 col-sm-2">商品原价：</label>
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" name="pd_yuan_price" id="" placeholder="商品原价" value="{$info.pd_yuan_price|default=''}" class="input-text" style="width:50%"> 元
                </div>
            </div>
            <div class="row cl">
                <label class="form-label col-xs-4 col-sm-2">商品折扣价：</label>
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" name="pd_discount_price" id="" placeholder="商品金额消耗" value="{$info.pd_discount_price|default=''}" class="input-text" style="width:50%"> 元
                </div>
            </div>
            <div class="row cl">
                <label class="form-label col-xs-4 col-sm-2">商品进货价：</label>
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" name="pd_stock_price" id="" placeholder="商品金额消耗" value="{$info.pd_stock_price|default=''}" class="input-text" style="width:50%"> 元
                </div>
            </div>
            <div class="row cl">
                <label class="form-label col-xs-4 col-sm-2">商品信用值：</label>
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" name="pd_integrity_price" id="" placeholder="商品信用值消耗" value="{$info.pd_integrity_price|default=''}" class="input-text" style="width:50%">
                </div>
            </div>
            <div class="row cl">
                <label class="form-label col-xs-4 col-sm-2">商品结算价：</label>
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" name="pd_convert_price" id="" placeholder="" value="{$info.pd_convert_price|default=''}" class="input-text" style="width:50%"> 元
                </div>
            </div>
           <!--  <div class="row cl">
                <label class="form-label col-xs-4 col-sm-2">赠送信用值：</label>
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" name="pd_integrity" id="" placeholder="" value="" class="input-text" style="width:50%" disabled> 元
                </div>
            </div> -->
            
            <div class="row cl">
                <label class="form-label col-xs-4 col-sm-2">商品库存：</label>
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" name="pd_store" id="" placeholder="库存" value="{$info.pd_store|default=''}" class="input-text" style="width:50%">
                </div>
            </div>
            <div class="row cl">
                <label class="form-label col-xs-4 col-sm-2">产品主图：</label>
                <div class="formControls col-xs-8 col-sm-9">
                    <div class="uploader-thum-container">
                        <div id="fileList" class="uploader-list">
                            <div id="" class="item">
                                <div class="pic-box"><img style="width: 100px;height: 100px" src="/uploads/pd/{$info.pd_pic|default='null.jpg'}"></div>
                                <div class="info"></div>
                            </div>
                        </div>
                        <div id="filePicker">选择图片</div>
                        <button onclick="return false;" id="btn-star" class="btn btn-default btn-uploadstar radius ml-10">开始上传</button>
                    </div>
                </div>
            </div>
            <input class="hidden pd_pic" type="text" value="{$info.pd_pic|default=''}" name='pd_pic'>
            <div class="row cl">
                <label class="form-label col-xs-4 col-sm-2">详细内容：</label>
                <div class="formControls col-xs-8 col-sm-9">
                    <textarea id="editor" type="text/plain" style="width:100%;height:400px;" name="pd_detail" >
                    </textarea>
                </div>
            </div>
            <div class="row cl">
                <div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
                    <button onClick="return savePro();" class="btn btn-primary radius" type="submit"><i class="Hui-iconfont">&#xe632;</i> 确认提交</button>
                    <!-- <button onClick="layer_close();" class="btn btn-default radius" type="reset">&nbsp;&nbsp;取消&nbsp;&nbsp;</button> -->
                </div>
            </div>
        </form>
    </div>
    {include file="public/_footer" /}
    <!--请在下方写此页面业务相关的脚本-->
    <script type="text/javascript" src="/static/admin/lib/jquery.validation/1.14.0/jquery.validate.js"></script>
    <script type="text/javascript" src="/static/admin/lib/jquery.validation/1.14.0/validate-methods.js"></script>
    <script type="text/javascript" src="/static/admin/lib/jquery.validation/1.14.0/messages_zh.js"></script>
    <script type="text/javascript" src="/static/admin/lib/webuploader/0.1.5/webuploader.min.js"></script>
    <script type="text/javascript" src="/static/admin/lib/ueditor/1.4.3/ueditor.config.js"></script>
    <script type="text/javascript" src="/static/admin/lib/ueditor/1.4.3/ueditor.all.min.js"></script>
    <script type="text/javascript" src="/static/admin/lib/ueditor/1.4.3/lang/zh-cn/zh-cn.js"></script>
    <script type="text/javascript">
    $(function() {
        var ue = UE.getEditor('editor');
        
        $('.skin-minimal input').iCheck({
            checkboxClass: 'icheckbox-blue',
            radioClass: 'iradio-blue',
            increaseArea: '20%'
        });

        $list = $("#fileList"),
            $btn = $("#btn-star"),
            state = "pending",
            uploader;

        var uploader = WebUploader.create({
            auto: false,
            // swf: '/static/admin/lib/webuploader/0.1.5/Uploader.swf',
            // 文件接收服务端。
            server: '/static/admin/lib/webuploader/0.1.5/server/fileupload.php',

            // 选择文件的按钮。可选。
            // 内部根据当前运行是创建，可能是input元素，也可能是flash.
            pick: '#filePicker',

            // 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！
            resize: false,
            // 只允许选择图片文件。
            accept: {
                title: 'Images',
                extensions: 'gif,jpg,jpeg,bmp,png',
                mimeTypes: 'image/jpg,image/jpeg,image/png'
            }
        });
        uploader.on('fileQueued', function(file) {
            var $li = $(
                    '<div id="' + file.id + '" class="item">' +
                    '<div class="pic-box"><img></div>' +
                    '<div class="info">' + file.name + '</div>' +
                    '<p class="state">等待上传...</p>' +
                    '</div>'
                ),
                $img = $li.find('img');
            $list.html($li);
            // 创建缩略图
            // 如果为非图片文件，可以不用调用此方法。
            // thumbnailWidth x thumbnailHeight 为 100 x 100
            uploader.makeThumb(file, function(error, src) {
                if (error) {
                    $img.replaceWith('<span>不能预览</span>');
                    return;
                }

                $img.attr('src', src);
            }, 100, 100);
        });
        // 文件上传过程中创建进度条实时显示。
        uploader.on('uploadProgress', function(file, percentage) {
            var $li = $('#' + file.id),
                $percent = $li.find('.progress-box .sr-only');

            // 避免重复创建
            if (!$percent.length) {
                $percent = $('<div class="progress-box"><span class="progress-bar radius"><span class="sr-only" style="width:0%"></span></span></div>').appendTo($li).find('.sr-only');
            }
            $li.find(".state").text("上传中");
            $percent.css('width', percentage * 100 + '%');
        });

        // 文件上传成功，给item添加成功class, 用样式标记上传成功。
        uploader.on('uploadSuccess', function(file, response) {
            $('#' + file.id).addClass('upload-state-success').find(".state").text("已上传");
            $('.pd_pic').val(response + getExt(file.name))
        });

        // 文件上传失败，显示上传出错。
        uploader.on('uploadError', function(file) {
            $('#' + file.id).addClass('upload-state-error').find(".state").text("上传出错");
        });

        // 完成上传完了，成功或者失败，先删除进度条。
        uploader.on('uploadComplete', function(file) {
            $('#' + file.id).find('.progress-box').fadeOut();
        });
        uploader.on('all', function(type) {
            if (type === 'startUpload') {
                state = 'uploading';
            } else if (type === 'stopUpload') {
                state = 'paused';
            } else if (type === 'uploadFinished') {
                state = 'done';
            }

            // if (state === 'uploading') {
            //     $btn.text('暂停上传');
            // } else {
            //     $btn.text('开始上传');
            // }
        });

        $btn.on('click', function() {
            if (state === 'uploading') {
                uploader.stop();
            } else {
                uploader.upload();
            }
        });

    });



    

    function getExt(uploadf) {
        var index1 = uploadf.lastIndexOf(".");
        var index2 = uploadf.length;
        return uploadf.substring(index1, index2);
    }


    function savePro() {
        $.post('{:url("Product/addProduct")}', $('#form-article-add').serialize()).success(function(data) {
            layer.msg(data.msg);
            if (data.code) {
                setTimeout(function() {
                    location.href = '{:url("product/index")}';
                }, 500);
            }
        });
        return false;
    }
    </script>
</body>

</html>